{{ $rootUser := (randAlphaNum 16) }}
{{ $rootPassword := (randAlphaNum 32) }}
{{ $host := cat "https://minio-s3" (lookup "v1" "Secret" .Release.Namespace "cluster-url").data.BASE_URL | b64dec) }}
apiVersion: v1
kind: Secret
metadata:
  name: minio-root-user
  annotations:
    argocd.argoproj.io/sync-wave: "10"
type: Opaque
stringData:
  MINIO_ROOT_USER: {{ $rootUser }}
  MINIO_ROOT_PASSWORD: {{ rootPassword }}
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    opendatahub.io/connection-type: s3
    openshift.io/display-name: Model Storage
    argocd.argoproj.io/sync-wave: "10"
  labels:
    opendatahub.io/dashboard: "true"
    opendatahub.io/managed: "true"
  name: models
data:
  AWS_ACCESS_KEY_ID: {{ $rootUser }}
  AWS_SECRET_ACCESS_KEY: {{ rootPassword }}
stringData:
  AWS_DEFAULT_REGION: us-east-1
  AWS_S3_BUCKET: {{ .Values.buckets.models }}
  AWS_S3_ENDPOINT: {{ $host }}
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    opendatahub.io/connection-type: s3
    openshift.io/display-name: Pipeline Artifacts
    argocd.argoproj.io/sync-wave: "10"
  labels:
    opendatahub.io/dashboard: "true"
    opendatahub.io/managed: "true"
  name: pipeline-artifacts
data:
  AWS_ACCESS_KEY_ID: {{ $rootUser }}
  AWS_SECRET_ACCESS_KEY: {{ rootPassword }}
stringData:
  AWS_DEFAULT_REGION: us-east-1
  AWS_S3_BUCKET: {{ .Values.buckets.pipelineArtifacts }}
  AWS_S3_ENDPOINT: {{ $host }}
type: Opaque